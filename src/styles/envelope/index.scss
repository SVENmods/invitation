@use 'sass:color';

$color-env: #E9E3D7;
$color-env2: color.adjust($color-env, $lightness: -3%);
$color-flap: color.adjust($color-env, $lightness: -5%);
$color-bg: color.adjust($color-env, $lightness: 48%);

$env-border-radius: 6px;
$env-max-width: 520px;
$env-max-height: 340px;

.envelope {
     --env-width: min(#{$env-max-width}, calc(100vw - 2rem));
     --env-height: calc(var(--env-width) * #{$env-max-height} / #{$env-max-width});
     --seal-size: clamp(46px, calc(var(--env-width) * 0.123), 64px);

     position: relative;
     width: var(--env-width);
     height: var(--env-height);
     border-bottom-left-radius: $env-border-radius;
     border-bottom-right-radius: $env-border-radius;
     margin-left: auto;
     margin-right: auto;
     background-color: $color-flap;
     box-shadow: 0 4px 20px rgba(0, 0, 0, .18);
     transition: box-shadow .3s ease, transform .3s ease;
}

.envelope:hover {
     box-shadow: 0 12px 32px rgba(0, 0, 0, .2);
     transform: translateY(-2px);
}

.front {
     position: absolute;
     width: 0;
     height: 0;
     z-index: 3;
}

.flap {
     border-left: calc(var(--env-width) / 2) solid transparent;
     border-right: calc(var(--env-width) / 2) solid transparent;
     border-bottom: calc(var(--env-height) / 2 - 8px) solid transparent;
     border-top: calc(var(--env-height) / 2 + 8px) solid $color-flap;
     transform-origin: top;
     pointer-events: none;
}

.pocket {
     border-left: calc(var(--env-width) / 2) solid $color-env;
     border-right: calc(var(--env-width) / 2) solid $color-env;
     border-bottom: calc(var(--env-height) / 2) solid $color-env;
     border-top: calc(var(--env-height) / 2) solid transparent;
     border-bottom-left-radius: $env-border-radius;
     border-bottom-right-radius: $env-border-radius;
}

.letter {
     position: relative;
     background-color: $color-env;
     width: 90%;
     margin-left: auto;
     margin-right: auto;
     height: 90%;
     top: 5%;
     border-radius: $env-border-radius;
     box-shadow: 0 2px 26px rgba(0, 0, 0, .12);
}

.letter:after {
     content: '';
     position: absolute;
     top: 0;
     bottom: 0;
     left: 0;
     right: 0;
     background-image:
          linear-gradient(180deg,
               rgba(255, 255, 255, 0.00) 25%,
               rgba(239, 233, 215, 0.7) 55%,
               rgb(239, 233, 215) 100%);
}

.words {
     position: absolute;
     left: 10%;
     width: 80%;
     height: 14%;
     background-color: $color-bg;
}

.words.line1 {
     top: 15%;
     width: 20%;
     height: 7%;
}

.words.line2 {
     top: 30%;
}

.words.line3 {
     top: 50%;
}

.words.line4 {
     top: 70%;
}

.open .flap {
     transform: rotateX(180deg);
     transition: transform .4s ease, z-index .6s;
     z-index: 1;
}

.close .flap {
     transform: rotateX(0deg);
     transition: transform .4s .6s ease, z-index 1s;
     z-index: 5;
}

.close .letter {
     transform: translateY(0px);
     transition: transform .4s ease, z-index 1s;
     z-index: 1;
}

.open .letter {
     transform: translateY(calc(-1 * var(--env-height) / 3));
     transition: transform .4s .6s ease, z-index .6s;
     z-index: 2;
}

.seal {
     position: absolute;
     z-index: 10;
     width: var(--seal-size);
     height: var(--seal-size);
     border-radius: 9999px;
     background-image: url('/img/stamp.png');
     background-size: cover;
     background-position: center;
     background-repeat: no-repeat;
     border: 1px solid rgba(217, 210, 195, .9);
     background-color: #E9E3D7;
     left: 50%;
     top: 50%;
     transform: translate(-50%, -50%);
     box-shadow: 0 4px 10px rgba(0, 0, 0, .12);
     pointer-events: none;
}

.seal::before {
     content: '';
     position: absolute;
     inset: clamp(7px, calc(var(--seal-size) * 0.16), 10px);
     border-radius: inherit;
     border: 1px solid rgba(201, 169, 106, .85);
}

.letter-modal {
     will-change: transform;
     transition: transform .3s ease-out, box-shadow .3s ease-out;
}

.letter-modal:hover {
     transform: translateY(0);
     box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
}

@keyframes letterHoverBounce {
     0% {
          transform: translateY(0);
          box-shadow: var(--shadow-card);
     }

     40% {
          transform: translateY(-4px);
          box-shadow: 0 18px 40px rgba(0, 0, 0, 0.08);
     }

     100% {
          transform: translateY(0);
          box-shadow: var(--shadow-card);
     }
}

@media (prefers-reduced-motion: reduce) {
     .envelope {
          transition: none;
          transform: none;
     }

     .letter-modal,
     .letter-modal:hover {
          transition: none;
          animation: none;
          transform: none;
     }
}